# SpringBootç«¯æ¼æ´æ£€æµ‹åŠŸèƒ½ - å®Œæ•´å®ç°æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

å®ç°äº†SpringBootç«¯çš„æ‰‹åŠ¨æ¼æ´æ£€æµ‹åŠŸèƒ½ï¼Œä»¿ç…§Javaé¡¹ç›®çš„æ¼æ´æ£€æµ‹éƒ¨åˆ†ï¼Œè°ƒç”¨Flaskç«¯çš„æ¼æ´æ£€æµ‹æ¥å£ï¼Œå°†æ£€æµ‹åˆ°çš„æ¼æ´å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶æ›´æ–°ç›¸å…³è¡¨ã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

1. **VulnerabilityDetectionService** - æ¼æ´æ£€æµ‹æœåŠ¡ç±»
   - è´Ÿè´£è°ƒç”¨Flask APIè¿›è¡Œæ¼æ´æ£€æµ‹
   - å¤„ç†æ£€æµ‹ç»“æœå¹¶å­˜å‚¨åˆ°æ•°æ®åº“
   - ç®¡ç†æ‰€æœ‰çš„æ•°æ®åº“è¡¨æ›´æ–°é€»è¾‘

2. **VulnerabilityController** - æ¼æ´æ£€æµ‹æ§åˆ¶å™¨
   - æä¾›æ‰‹åŠ¨è§¦å‘æ¼æ´æ£€æµ‹çš„REST API
   - æ”¯æŒå…¨é‡æ£€æµ‹å’ŒæŒ‡å®šå…¬å¸/è¯­è¨€çš„æ£€æµ‹

---

## ğŸ”„ å®Œæ•´æ£€æµ‹æµç¨‹

### æµç¨‹å›¾

```
1. ç”¨æˆ·è°ƒç”¨API
   â†“
2. è·å–æ‰€æœ‰æ¼æ´æŠ¥å‘Š
   â†“
3. ä»white_listè¡¨è¯»å–ç»„ä»¶åˆ—è¡¨
   â†“
4. è°ƒç”¨Flask APIè¿›è¡Œæ¼æ´åŒ¹é…
   â”œâ”€ å‚æ•°ï¼šCVE ID, æè¿°, ç™½åå•, é˜ˆå€¼, è¯­è¨€
   â””â”€ è¿”å›ï¼šåŒ¹é…çš„ç»„ä»¶åç§°ï¼ˆåˆ†å·åˆ†éš”ï¼‰
   â†“
5. è§£æåŒ¹é…ç»“æœ
   â†“
6. å­˜å‚¨åˆ°æ•°æ®åº“ï¼ˆ4ä¸ªè¡¨ï¼‰
   â”œâ”€ vulnerability_report è¡¨
   â”œâ”€ vulnerability è¡¨
   â”œâ”€ vulnerability_report_vulnerability è¡¨
   â””â”€ project_vulnerability è¡¨
```

---

## ğŸ“Š æ•°æ®åº“æ›´æ–°é€»è¾‘

### æ­¥éª¤1ï¼šä¿å­˜æˆ–æ›´æ–°æ¼æ´æŠ¥å‘Š

**è¡¨å**: `vulnerability_report`

```java
// æ£€æŸ¥æ¼æ´æŠ¥å‘Šæ˜¯å¦å·²å­˜åœ¨
VulnerabilityReport existingReport = vulnerabilityReportMapper.selectById(vulnerabilityReport.getId());

if (existingReport == null) {
    // ä¸å­˜åœ¨åˆ™æ’å…¥æ–°è®°å½•
    vulnerabilityReportMapper.insert(vulnerabilityReport);
} else {
    // å·²å­˜åœ¨åˆ™è·³è¿‡ï¼ˆé¿å…é‡å¤ï¼‰
    System.out.println("æ¼æ´æŠ¥å‘Šå·²å­˜åœ¨ï¼ŒCVE: " + vulnerabilityReport.getCveId());
}
```

**å­—æ®µè¯´æ˜**:
- `id`: æ¼æ´æŠ¥å‘ŠID
- `cve_id`: CVEç¼–å·
- `vulnerability_name`: æ¼æ´åç§°
- `description`: æ¼æ´æè¿°
- `risk_level`: é£é™©ç­‰çº§ï¼ˆHIGH, MEDIUM, LOWï¼‰
- `disclosure_time`: æŠ«éœ²æ—¶é—´

---

### æ­¥éª¤2ï¼šä¸ºæ¯ä¸ªåŒ¹é…çš„ç»„ä»¶åˆ›å»ºæ¼æ´è®°å½•

**è¡¨å**: `vulnerability`

```java
// éå†ç™½åå•ä¸­çš„æ¯ä¸ªç»„ä»¶
for (JsonNode whiteListItem : whiteListArray) {
    String componentName = whiteListItem.get("name").asText();
    String projectId = whiteListItem.get("pojectid").asText();

    if (componentList.contains(componentName)) {
        // åˆ›å»ºæ¼æ´è®°å½•
        Vulnerability vulnerability = new Vulnerability();
        vulnerability.setDescription(vulnerabilityReport.getDescription());
        vulnerability.setIsAccept(0);
        vulnerability.setIsDelete(0);
        vulnerability.setName(vulnerabilityReport.getVulnerabilityName());  // â† ä½¿ç”¨æ¼æ´åç§°è€Œä¸æ˜¯ç»„ä»¶åç§°
        vulnerability.setRiskLevel(vulnerabilityReport.getRiskLevel());
        vulnerability.setTime(vulnerabilityReport.getDisclosureTime());
        vulnerability.setLanguage(language);
        vulnerability.setRef(vulnerabilityReport.getCveId());

        vulnerabilityMapper.insert(vulnerability);
        // ...åç»­å…³è”æ“ä½œ
    }
}
```

**é‡è¦è¯´æ˜**:
- âœ… `name` å­—æ®µä½¿ç”¨ `vulnerabilityReport.getVulnerabilityName()` - çœŸå®çš„æ¼æ´åç§°
- âœ… æ¯ä¸ªåŒ¹é…çš„ç»„ä»¶éƒ½ä¼šåˆ›å»ºä¸€æ¡ç‹¬ç«‹çš„æ¼æ´è®°å½•
- âœ… `is_delete = 0` è¡¨ç¤ºè®°å½•æœ‰æ•ˆ

---

### æ­¥éª¤3ï¼šåˆ›å»ºæ¼æ´æŠ¥å‘Š-æ¼æ´å…³è”

**è¡¨å**: `vulnerability_report_vulnerability`

```java
VulnerabilityReportVulnerability vrv = new VulnerabilityReportVulnerability();
vrv.setVulnerabilityId(vulnerability.getId());
vrv.setVulnerabilityReportId(vulnerabilityReport.getId());
vrv.setIsDelete(0);

vulnerabilityReportVulnerabilityMapper.insert(vrv);
```

**ä½œç”¨**: å»ºç«‹æ¼æ´æŠ¥å‘Šå’Œå…·ä½“æ¼æ´ä¹‹é—´çš„å…³è”

---

### æ­¥éª¤4ï¼šåˆ›å»ºé¡¹ç›®-æ¼æ´å…³è”

**è¡¨å**: `project_vulnerability`

```java
ProjectVulnerability pv = new ProjectVulnerability();
pv.setVulnerabilityId(vulnerability.getId());
pv.setProjectId(Integer.parseInt(projectId));  // â† ä»ç™½åå•ä¸­è·å–çš„é¡¹ç›®ID
pv.setIsDelete(0);

projectVulnerabilityMapper.insert(pv);
```

**ä½œç”¨**: æ ‡è®°å“ªäº›é¡¹ç›®å—åˆ°å“ªäº›æ¼æ´çš„å½±å“

**å…³é”®é€»è¾‘**:
```
white_listè¡¨ä¸­çš„ç»„ä»¶ â†’ åŒ…å« project_idï¼ˆä»file_pathæ˜ å°„ï¼‰
                    â†“
            å¦‚æœç»„ä»¶æœ‰æ¼æ´
                    â†“
    project_vulnerabilityè¡¨è®°å½•ï¼šproject_id â†” vulnerability_id
```

---

## ğŸ¯ é˜ˆå€¼å¤„ç†é€»è¾‘

### 1. ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆsimilarityThresholdï¼‰

**æ¥æº**: `company` è¡¨çš„ `similarity_threshold` å­—æ®µ

**ä¼ é€’åˆ°Flask API**:
```java
params.put("similarityThreshold", company.getSimilarityThreshold().toString());
```

**åœ¨Flaskç«¯çš„ä½œç”¨**:
- æ§åˆ¶TF-IDFç®—æ³•çš„åŒ¹é…ä¸¥æ ¼åº¦
- åªæœ‰ç›¸ä¼¼åº¦ â‰¥ é˜ˆå€¼çš„ç»„ä»¶æ‰ä¼šè¢«è¿”å›
- ä¾‹å¦‚ï¼šé˜ˆå€¼=0.5ï¼Œè¡¨ç¤ºç›¸ä¼¼åº¦ä½äº50%çš„ç»„ä»¶ä¸ä¼šè¢«åŒ¹é…

**æ•°æ®æµ**:
```
company.similarity_threshold
         â†“
  ä¼ é€’ç»™Flask API
         â†“
Flaskä½¿ç”¨TF-IDFç®—æ³•è®¡ç®—ç›¸ä¼¼åº¦
         â†“
è¿‡æ»¤æ‰ç›¸ä¼¼åº¦ < é˜ˆå€¼çš„ç»„ä»¶
         â†“
è¿”å›åŒ¹é…çš„ç»„ä»¶åç§°
```

---

### 2. æœ€å¤§æ£€æµ‹æ•°é‡ï¼ˆmaxDetectNumsï¼‰

**æ¥æº**: `company` è¡¨çš„ `max_detect_nums` å­—æ®µ

**åº”ç”¨é€»è¾‘**:
```java
List<String> componentList = Arrays.asList(matchedComponents.split(";"));

// æ ¹æ®maxDetectNumåšæˆªæ–­
if (componentList.size() > maxDetectNum) {
    componentList = componentList.subList(0, maxDetectNum);
}

// åªä¸ºå‰Nä¸ªåŒ¹é…çš„ç»„ä»¶åˆ›å»ºæ¼æ´è®°å½•
for (JsonNode whiteListItem : whiteListArray) {
    if (componentList.contains(componentName)) {
        // åˆ›å»ºæ¼æ´è®°å½•...
    }
}
```

**ä½œç”¨**:
- é™åˆ¶æ¯ä¸ªæ¼æ´æœ€å¤šæ£€æµ‹çš„ç»„ä»¶æ•°é‡
- é¿å…ä¸€ä¸ªæ¼æ´åŒ¹é…è¿‡å¤šç»„ä»¶å¯¼è‡´æ•°æ®åº“è®°å½•çˆ†ç‚¸
- ä¾‹å¦‚ï¼šmaxDetectNums=10ï¼Œåˆ™æ¯ä¸ªCVEæœ€å¤šæ ‡è®°10ä¸ªæœ‰æ¼æ´çš„ç»„ä»¶

**ç¤ºä¾‹**:
```
Flaskè¿”å›ï¼šcomponent1;component2;component3;...;component15
              â†“
maxDetectNums = 10
              â†“
åªå¤„ç†å‰10ä¸ªï¼šcomponent1;component2;...;component10
              â†“
åˆ›å»º10æ¡vulnerabilityè®°å½• + 10æ¡project_vulnerabilityè®°å½•
```

---

## ğŸ”Œ REST APIæ¥å£

### 1. å…¨é‡æ¼æ´æ£€æµ‹

**æ¥å£**: `POST /vulnerability/detect/all`

**è¯´æ˜**: å¯¹æ‰€æœ‰å…¬å¸çš„æ‰€æœ‰è¯­è¨€è¿›è¡Œæ¼æ´æ£€æµ‹

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X POST http://localhost:8081/vulnerability/detect/all
```

**è¿”å›ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "SUCCESS",
  "obj": {
    "totalProcessed": 150,
    "totalDetected": 45,
    "companiesCount": 2,
    "languagesCount": 9,
    "details": [
      {
        "processedCount": 50,
        "detectedCount": 15,
        "company": "å…¬å¸A",
        "language": "java"
      },
      ...
    ]
  }
}
```

---

### 2. æŒ‡å®šå…¬å¸å’Œè¯­è¨€çš„æ¼æ´æ£€æµ‹

**æ¥å£**: `POST /vulnerability/detect`

**å‚æ•°**:
- `companyId` (int): å…¬å¸ID
- `language` (string): è¯­è¨€ç±»å‹ï¼ˆjava, python, php, ruby, go, rust, javascript, erlang, cï¼‰

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X POST "http://localhost:8081/vulnerability/detect?companyId=1&language=java"
```

**è¿”å›ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "SUCCESS",
  "obj": {
    "processedCount": 50,
    "detectedCount": 15,
    "company": "å…¬å¸A",
    "language": "java"
  }
}
```

---

### 3. é¡¹ç›®çº§åˆ«æ¼æ´æ£€æµ‹ï¼ˆå¼€å‘ä¸­ï¼‰

**æ¥å£**: `POST /vulnerability/detect/project`

**å‚æ•°**:
- `projectId` (int): é¡¹ç›®ID

**çŠ¶æ€**: åŠŸèƒ½å¼€å‘ä¸­

---

## ğŸ“ˆ ä»white_listè¡¨è¯»å–ç»„ä»¶é€»è¾‘

### æ ¸å¿ƒæ–¹æ³•: `getWhiteListFromDatabase()`

**æ­¥éª¤**:

1. **è·å–å…¬å¸ä¿¡æ¯**
```java
Company company = companyMapper.selectById(companyId);
```

2. **è§£æé¡¹ç›®IDåˆ—è¡¨**
```java
// company.projectId æ˜¯JSONæ ¼å¼: {"32": "1", "33": "1"}
JsonNode projectIdJson = mapper.readTree(company.getProjectId());
List<Integer> projectIds = new ArrayList<>();

Iterator<String> fieldNames = projectIdJson.fieldNames();
while (fieldNames.hasNext()) {
    String projectIdStr = fieldNames.next();
    projectIds.add(Integer.parseInt(projectIdStr));
}
```

3. **æŸ¥è¯¢é¡¹ç›®è¯¦æƒ…è·å–æ–‡ä»¶è·¯å¾„**
```java
List<Project> projects = projectMapper.selectBatchIds(projectIds);
List<String> projectPaths = projects.stream()
    .map(Project::getFile)
    .filter(file -> file != null && !file.isEmpty())
    .collect(Collectors.toList());
```

4. **æŸ¥è¯¢white_listè¡¨**
```java
List<WhiteList> whiteLists = whiteListMapper.selectList(
    new QueryWrapper<WhiteList>()
        .in("file_path", projectPaths)
        .eq("language", language)
        .eq("isdelete", 0)
);
```

5. **æ„å»ºJSONæ ¼å¼è¿”å›**
```java
[
  {
    "name": "lxml",
    "language": "python",
    "pojectid": "32"
  },
  {
    "name": "requests",
    "language": "python",
    "pojectid": "32"
  },
  ...
]
```

**å…³é”®ç‚¹**:
- âœ… ä½¿ç”¨ `file_path` å­—æ®µå…³è”é¡¹ç›®å’Œç»„ä»¶
- âœ… è¿‡æ»¤æŒ‡å®šè¯­è¨€çš„ç»„ä»¶
- âœ… åªæŸ¥è¯¢æœªåˆ é™¤çš„è®°å½•ï¼ˆisdelete=0ï¼‰
- âœ… è¿”å›çš„JSONåŒ…å«é¡¹ç›®IDï¼Œç”¨äºåç»­åˆ›å»ºproject_vulnerabilityå…³è”

---

## ğŸ” Flask APIè°ƒç”¨è¯¦æƒ…

### è¯·æ±‚å‚æ•°

```java
Map<String, String> params = new HashMap<>();
params.put("cve_id", vulnerabilityReport.getCveId());           // CVEç¼–å·
params.put("desc", vulnerabilityReport.getDescription());       // æ¼æ´æè¿°
params.put("white_list", whiteListJson);                        // ç»„ä»¶ç™½åå•JSON
params.put("company", company.getName());                       // å…¬å¸åç§°
params.put("detect_strategy", company.getDetectStrategy());     // æ£€æµ‹ç­–ç•¥ï¼ˆtfidf/keyword/bertï¼‰
params.put("similarityThreshold", company.getSimilarityThreshold().toString()); // ç›¸ä¼¼åº¦é˜ˆå€¼
params.put("language", language);                               // è¯­è¨€ç±»å‹
```

### è¿”å›æ ¼å¼

Flask APIè¿”å›åŒ¹é…çš„ç»„ä»¶åç§°ï¼ˆåˆ†å·åˆ†éš”ï¼‰ï¼š
```
lxml;requests;Pillow;beautifulsoup4
```

### å¼‚å¸¸å¤„ç†

```java
try {
    response = restTemplate.exchange(url, HttpMethod.POST, requestEntity, String.class);
    // å¤„ç†å“åº”...
} catch (HttpServerErrorException e) {
    // FlaskæœåŠ¡è¿”å›5xxé”™è¯¯
    System.err.println("FlaskæœåŠ¡è¿”å›5xxé”™è¯¯: " + e.getMessage());
} catch (HttpClientErrorException e) {
    // FlaskæœåŠ¡è¿”å›4xxé”™è¯¯
    System.err.println("FlaskæœåŠ¡è¿”å›4xxé”™è¯¯: " + e.getMessage());
} catch (RestClientException e) {
    // å…¶ä»–RESTè°ƒç”¨å¼‚å¸¸ï¼ˆè¿æ¥å¤±è´¥ã€è¶…æ—¶ç­‰ï¼‰
    System.err.println("RESTè°ƒç”¨å¼‚å¸¸: " + e.getMessage());
}
```

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„è¯´æ˜

### vulnerability_report è¡¨
```
id                    æ¼æ´æŠ¥å‘ŠIDï¼ˆä¸»é”®ï¼‰
cve_id                CVEç¼–å·
vulnerability_name    æ¼æ´åç§°
description           æ¼æ´æè¿°
risk_level            é£é™©ç­‰çº§
disclosure_time       æŠ«éœ²æ—¶é—´
...
```

### vulnerability è¡¨
```
id                    æ¼æ´IDï¼ˆä¸»é”®ï¼‰
name                  æ¼æ´åç§°ï¼ˆæ¥è‡ªvulnerability_report.vulnerability_nameï¼‰
ref                   CVEç¼–å·
description           æ¼æ´æè¿°
risk_level            é£é™©ç­‰çº§
language              è¯­è¨€ç±»å‹
time                  æ—¶é—´
is_accept             æ˜¯å¦é‡‡çº³ï¼ˆ0=æœªé‡‡çº³, 1=å·²é‡‡çº³ï¼‰
is_delete             æ˜¯å¦åˆ é™¤ï¼ˆ0=æœ‰æ•ˆ, 1=å·²åˆ é™¤ï¼‰
```

### vulnerability_report_vulnerability è¡¨ï¼ˆå…³è”è¡¨ï¼‰
```
vulnerability_id              æ¼æ´ID â†’ vulnerability.id
vulnerability_report_id       æ¼æ´æŠ¥å‘ŠID â†’ vulnerability_report.id
is_delete                     æ˜¯å¦åˆ é™¤
```

### project_vulnerability è¡¨ï¼ˆå…³è”è¡¨ï¼‰
```
project_id            é¡¹ç›®ID â†’ project.id
vulnerability_id      æ¼æ´ID â†’ vulnerability.id
isdelete              æ˜¯å¦åˆ é™¤
```

### white_list è¡¨
```
id                    ç»„ä»¶ID
name                  ç»„ä»¶åç§°
language              è¯­è¨€ç±»å‹
file_path             é¡¹ç›®è·¯å¾„ï¼ˆç”¨äºå…³è”projectè¡¨ï¼‰
isdelete              æ˜¯å¦åˆ é™¤
```

---

## ğŸ§ª æµ‹è¯•æµç¨‹

### å‡†å¤‡å·¥ä½œ

1. **ç¡®ä¿æœ‰æ¼æ´æŠ¥å‘Šæ•°æ®**
```sql
SELECT COUNT(*) FROM vulnerability_report;
```

å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œéœ€è¦å…ˆè¿è¡ŒXXL-JOBçš„æ¼æ´çˆ¬å–ä»»åŠ¡

2. **ç¡®ä¿white_listè¡¨æœ‰ç»„ä»¶æ•°æ®**
```sql
SELECT language, COUNT(*) as count
FROM white_list
WHERE isdelete = 0
GROUP BY language;
```

3. **ç¡®ä¿FlaskæœåŠ¡è¿è¡Œæ­£å¸¸**
```bash
curl -s http://localhost:5000/health
```

### æµ‹è¯•æ­¥éª¤

#### æµ‹è¯•1ï¼šæŒ‡å®šå…¬å¸å’Œè¯­è¨€æ£€æµ‹

```bash
# æ£€æµ‹å…¬å¸1çš„Javaç»„ä»¶
curl -X POST "http://localhost:8081/vulnerability/detect?companyId=1&language=java"
```

**æœŸæœ›ç»“æœ**:
- è¿”å›code=200
- processedCount > 0ï¼ˆå¤„ç†çš„æ¼æ´æŠ¥å‘Šæ•°ï¼‰
- detectedCount >= 0ï¼ˆæ£€æµ‹åˆ°çš„æœ‰æ¼æ´ç»„ä»¶æ•°ï¼‰

#### æµ‹è¯•2ï¼šéªŒè¯æ•°æ®åº“è®°å½•

```sql
-- æŸ¥çœ‹æ–°å¢çš„æ¼æ´è®°å½•
SELECT id, name, ref, language, risk_level
FROM vulnerability
WHERE is_delete = 0
ORDER BY id DESC
LIMIT 10;

-- æŸ¥çœ‹é¡¹ç›®-æ¼æ´å…³è”
SELECT
    p.id as project_id,
    p.name as project_name,
    v.name as vulnerability_name,
    v.ref as cve_id,
    v.risk_level
FROM project_vulnerability pv
JOIN project p ON pv.project_id = p.id
JOIN vulnerability v ON pv.vulnerability_id = v.id
WHERE pv.isdelete = 0
ORDER BY pv.id DESC
LIMIT 10;
```

#### æµ‹è¯•3ï¼šå…¨é‡æ£€æµ‹ï¼ˆå¯é€‰ï¼‰

```bash
curl -X POST "http://localhost:8081/vulnerability/detect/all"
```

**æ³¨æ„**: å…¨é‡æ£€æµ‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. æ¼æ´åç§°å­—æ®µå¤„ç†

**é—®é¢˜**: ä¹‹å‰vulnerabilityè¡¨çš„nameå­—æ®µå­˜å‚¨çš„æ˜¯ç»„ä»¶åç§°ï¼Œå¯¼è‡´æ˜¾ç¤ºæ··ä¹±

**è§£å†³**: ä½¿ç”¨`vulnerabilityReport.getVulnerabilityName()`ä½œä¸ºæ¼æ´åç§°
```java
vulnerability.setName(vulnerabilityReport.getVulnerabilityName());
```

å¦‚æœvulnerabilityNameä¸ºç©ºï¼Œä¼šè‡ªåŠ¨ä»descriptionä¸­æå–ï¼š
```java
private void extractVulnerabilityNameIfEmpty(VulnerabilityReport report) {
    if (report.getVulnerabilityName() == null || report.getVulnerabilityName().trim().isEmpty()) {
        String description = report.getDescription();
        if (description != null && !description.isEmpty()) {
            String extracted = description.length() > 50 ?
                description.substring(0, 50) + "..." : description;
            report.setVulnerabilityName(extracted);
        } else {
            report.setVulnerabilityName("æœªçŸ¥æ¼æ´ - " + report.getCveId());
        }
    }
}
```

### 2. é˜ˆå€¼é…ç½®å»ºè®®

**similarityThresholdï¼ˆç›¸ä¼¼åº¦é˜ˆå€¼ï¼‰**:
- 0.3 - 0.5: å®½æ¾åŒ¹é…ï¼Œå¯èƒ½æœ‰è¯¯æŠ¥
- 0.5 - 0.7: å¹³è¡¡åŒ¹é…ï¼ˆæ¨èï¼‰
- 0.7 - 1.0: ä¸¥æ ¼åŒ¹é…ï¼Œå¯èƒ½æ¼æŠ¥

**maxDetectNumsï¼ˆæœ€å¤§æ£€æµ‹æ•°é‡ï¼‰**:
- 5 - 10: é€‚åˆå¤§å‹é¡¹ç›®ï¼ˆæ¨èï¼‰
- 10 - 50: é€‚åˆä¸­å°å‹é¡¹ç›®
- 50+: å¯èƒ½äº§ç”Ÿè¿‡å¤šè®°å½•

### 3. æ€§èƒ½è€ƒè™‘

- å…¨é‡æ£€æµ‹ä¼šéå†æ‰€æœ‰å…¬å¸Ã—æ‰€æœ‰è¯­è¨€Ã—æ‰€æœ‰æ¼æ´æŠ¥å‘Š
- å»ºè®®åœ¨ä½å³°æœŸæ‰§è¡Œå…¨é‡æ£€æµ‹
- å¯ä»¥é€šè¿‡æŒ‡å®šå…¬å¸å’Œè¯­è¨€è¿›è¡Œå¢é‡æ£€æµ‹

### 4. æ•°æ®ä¸€è‡´æ€§

- æ‰€æœ‰æ•°æ®åº“æ“ä½œä½¿ç”¨`@Transactional`æ³¨è§£ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§
- æ£€æµ‹å¤±è´¥ä¸ä¼šå½±å“å·²æ’å…¥çš„æ•°æ®
- æ”¯æŒé‡å¤è¿è¡Œï¼ˆä¼šæ£€æŸ¥æ¼æ´æŠ¥å‘Šæ˜¯å¦å·²å­˜åœ¨ï¼‰

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

1. **VulnerabilityDetectionService.java**
   - è·¯å¾„: `backend/src/main/java/com/nju/backend/service/vulnerability/VulnerabilityDetectionService.java`
   - åŠŸèƒ½: æ ¸å¿ƒæ¼æ´æ£€æµ‹æœåŠ¡

2. **test_vulnerability_detection.py**
   - è·¯å¾„: `VulSystem/test_vulnerability_detection.py`
   - åŠŸèƒ½: APIæµ‹è¯•è„šæœ¬

### ä¿®æ”¹æ–‡ä»¶

1. **VulnerabilityController.java**
   - è·¯å¾„: `backend/src/main/java/com/nju/backend/controller/VulnerabilityController.java`
   - ä¿®æ”¹: æ·»åŠ äº†3ä¸ªæ–°æ¥å£

---

## ğŸ¯ æ€»ç»“

### âœ… å·²å®ç°åŠŸèƒ½

1. **å®Œæ•´çš„æ¼æ´æ£€æµ‹æµç¨‹**
   - ä»white_listè¡¨è¯»å–ç»„ä»¶åˆ—è¡¨
   - è°ƒç”¨Flask APIè¿›è¡ŒTF-IDFåŒ¹é…
   - å­˜å‚¨ç»“æœåˆ°4ä¸ªæ•°æ®åº“è¡¨

2. **é˜ˆå€¼å¤„ç†**
   - similarityThresholdæ§åˆ¶åŒ¹é…ä¸¥æ ¼åº¦
   - maxDetectNumsé™åˆ¶æ£€æµ‹æ•°é‡

3. **æ•°æ®åº“æ›´æ–°é€»è¾‘**
   - vulnerability_reportè¡¨ï¼ˆæ¼æ´æŠ¥å‘Šï¼‰
   - vulnerabilityè¡¨ï¼ˆå…·ä½“æ¼æ´ï¼Œä½¿ç”¨çœŸå®æ¼æ´åç§°ï¼‰
   - vulnerability_report_vulnerabilityè¡¨ï¼ˆæŠ¥å‘Š-æ¼æ´å…³è”ï¼‰
   - project_vulnerabilityè¡¨ï¼ˆé¡¹ç›®-æ¼æ´å…³è”ï¼‰

4. **REST APIæ¥å£**
   - å…¨é‡æ£€æµ‹: `/vulnerability/detect/all`
   - æŒ‡å®šæ£€æµ‹: `/vulnerability/detect?companyId=X&language=Y`

### ğŸš€ ä½¿ç”¨æµç¨‹

```
1. ç¡®ä¿æœ‰æ¼æ´æŠ¥å‘Šæ•°æ®ï¼ˆé€šè¿‡XXL-JOBçˆ¬å–ï¼‰
2. ç¡®ä¿white_listè¡¨æœ‰ç»„ä»¶æ•°æ®ï¼ˆé€šè¿‡é¡¹ç›®ä¸Šä¼ å’Œè§£æï¼‰
3. è°ƒç”¨æ£€æµ‹API
4. æŸ¥è¯¢æ•°æ®åº“éªŒè¯ç»“æœ
```

### ğŸ“Š æ•°æ®æµå‘

```
æ¼æ´æŠ¥å‘Š(vulnerability_report)
         +
ç»„ä»¶ç™½åå•(white_list)
         â†“
    Flask APIæ£€æµ‹
         â†“
    åŒ¹é…çš„ç»„ä»¶
         â†“
    å­˜å‚¨åˆ°æ•°æ®åº“:
    - vulnerability (æ¼æ´è®°å½•)
    - vulnerability_report_vulnerability (å…³è”)
    - project_vulnerability (é¡¹ç›®å…³è”)
```

---

**å®ç°å®Œæˆæ—¶é—´**: 2025-11-14
**ç¼–è¯‘çŠ¶æ€**: âœ… BUILD SUCCESS
**æµ‹è¯•çŠ¶æ€**: å¾…ç”¨æˆ·æµ‹è¯•

