# Flask æ¼æ´æ£€æµ‹é€»è¾‘è¯¦è§£

**æ–‡æ¡£ç›®çš„**: è¯´æ˜Flaskåº”ç”¨å¦‚ä½•æ¥æ”¶åç«¯è¯·æ±‚ï¼Œè°ƒç”¨æ£€æµ‹ç®—æ³•ï¼Œå¹¶è¿”å›ç»“æœå­˜å‚¨åˆ°æ•°æ®åº“

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-11-14

---

## ä¸€ã€æ•´ä½“æµç¨‹æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Spring Boot åç«¯ (8081)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  VulnerabilityController                   â”‚                  â”‚
â”‚  â”‚  POST /vulnerability/detect                â”‚                  â”‚
â”‚  â”‚  + æ¥æ”¶ companyId, language å‚æ•°            â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚            â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  VulnerabilityDetectionService             â”‚                  â”‚
â”‚  â”‚  + æ„å»ºè¯·æ±‚å‚æ•° (CVE, æ¼æ´æè¿°, ç™½åå•)     â”‚                  â”‚
â”‚  â”‚  + è°ƒç”¨ Flask API                          â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ HTTP POST
             â”‚ URL: http://localhost:5000/vulnerabilities/detect
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Flask åº”ç”¨ (5000)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  /vulnerabilities/detect ç«¯ç‚¹               â”‚                  â”‚
â”‚  â”‚  def detect_vulnerabilities()               â”‚                  â”‚
â”‚  â”‚  + æ¥æ”¶ JSON è¯·æ±‚ä½“                         â”‚                  â”‚
â”‚  â”‚  + è°ƒç”¨ getLabels(params)                   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚            â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  getLabels.py (VulLibGen/getLabels.py)     â”‚                  â”‚
â”‚  â”‚  + è§£æè¯·æ±‚å‚æ•°                             â”‚                  â”‚
â”‚  â”‚  + é€‰æ‹©æ£€æµ‹ç­–ç•¥ (TinyModel æˆ– LLM)         â”‚                  â”‚
â”‚  â”‚  + é€‰æ‹©è¯­è¨€åº“ (Java æˆ– C)                   â”‚                  â”‚
â”‚  â”‚  + è°ƒç”¨å¯¹åº”çš„æ£€æµ‹ç®—æ³•                       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚            â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  tf_idf.py (æ£€æµ‹ç®—æ³•)                       â”‚                  â”‚
â”‚  â”‚  + tiny_model_process_data_to_json()       â”‚                  â”‚
â”‚  â”‚  + llm_process_data_to_json()              â”‚                  â”‚
â”‚  â”‚  + è°ƒç”¨ autodl è¿œç¨‹æœåŠ¡è¿›è¡Œ AI åŒ¹é…       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚            â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  threshold_cal.py (åå¤„ç†)                  â”‚                  â”‚
â”‚  â”‚  + process_libraries()                      â”‚                  â”‚
â”‚  â”‚  + ä½¿ç”¨ç›¸ä¼¼åº¦ç®—æ³•è¿‡æ»¤ç»“æœ                    â”‚                  â”‚
â”‚  â”‚  + (Levenshtein, Cosine, LCS)              â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚            â–¼                                                      â”‚
â”‚  è¿”å›ç»“æœ: "ç»„ä»¶1;ç»„ä»¶2;ç»„ä»¶3"                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ è¿”å›JSONå“åº”
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Spring Boot åç«¯ (8081)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  saveDetectionResults()                    â”‚                  â”‚
â”‚  â”‚  + è§£æ Flask è¿”å›çš„åŒ¹é…ç»„ä»¶                â”‚                  â”‚
â”‚  â”‚  + ä¸ºæ¯ä¸ªåŒ¹é…ç»„ä»¶åˆ›å»º Vulnerability è®°å½•   â”‚                  â”‚
â”‚  â”‚  + åˆ›å»ºå…³è”è¡¨è®°å½•                           â”‚                  â”‚
â”‚  â”‚  + ä¿å­˜åˆ°æ•°æ®åº“                             â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚            â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  æ•°æ®åº“ (MySQL)                            â”‚                  â”‚
â”‚  â”‚  + vulnerability è¡¨                        â”‚                  â”‚
â”‚  â”‚  + vulnerability_report è¡¨                 â”‚                  â”‚
â”‚  â”‚  + vulnerability_report_vulnerability è¡¨   â”‚                  â”‚
â”‚  â”‚  + project_vulnerability è¡¨                â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€Flask ç«¯è¯·æ±‚å¤„ç†è¯¦è§£

### 2.1 Flask ç«¯ç‚¹å®šä¹‰

**æ–‡ä»¶ä½ç½®**: `C:\Users\ä»»è‰¯ç‰\Desktop\kuling\kulin\app.py:1066-1081`

```python
@app.route('/vulnerabilities/detect', methods=['POST'])
def detect_vulnerabilities():
    # ä»è¯·æ±‚ä½“ä¸­è·å–JSONæ•°æ®ï¼Œæ·»åŠ nullæ£€æŸ¥
    params = request.get_json()

    if params is None:
        params = {}

    # print(params)
    data = getLabels(params=params)
    try:
        print("data=")
        print(data)
    except UnicodeEncodeError:
        print("data with unicode encoding issues")
    return jsonify(data)
```

### 2.2 è¯·æ±‚å‚æ•°æ ¼å¼

**æ¥è‡ªåç«¯çš„ HTTP POST è¯·æ±‚**:

```http
POST http://localhost:5000/vulnerabilities/detect
Content-Type: application/json

{
    "cve_id": "CVE-2021-44228",
    "desc": "Apache Log4j2 remote code execution vulnerability ...",
    "white_list": "[{\"name\": \"log4j-core\", \"language\": \"java\", \"pojectid\": \"1\"}]",
    "company": "æŸå…¬å¸",
    "detect_strategy": "TinyModel",
    "similarityThreshold": 0.8,
    "language": "java"
}
```

### 2.3 getLabels å‡½æ•°æµç¨‹

**æ–‡ä»¶ä½ç½®**: `C:\Users\ä»»è‰¯ç‰\Desktop\kuling\kulin\VulLibGen\getLabels.py:6-100`

#### Step 1: å‚æ•°è§£æ

```python
def getLabels(params=None):
    # æå–è¯·æ±‚å‚æ•°
    language = params.get('language')                    # "java" æˆ– "c"
    white_list = params.get('white_list')              # JSONå­—ç¬¦ä¸²
    detect_strategy = params.get('detect_strategy')    # "TinyModel" æˆ– "LLM"
    cve_id = params.get('cve_id')                      # CVE ID
    desc = params.get('desc')                          # æ¼æ´æè¿°
    company = params.get('company')                    # å…¬å¸åç§°
    similarityThreshold = params.get('similarityThreshold')  # ç›¸ä¼¼åº¦é˜ˆå€¼
```

#### Step 2: æ„é€ æµ‹è¯•æ•°æ®

```python
tests = [{
    "cve_id": cve_id,
    "labels": "",                    # åˆå§‹æ ‡ç­¾ä¸ºç©º
    "desc": desc                     # æ¼æ´æè¿°
}]
trains = tests
result = ""
```

#### Step 3: é€‰æ‹©è¯­è¨€å’Œè·¯å¾„

**TinyModel ç­–ç•¥**:
```python
if detect_strategy == 'TinyModel':
    if language == 'java':
        pros_path = 'VulLibGen/white_list/label_desc.csv'          # Javaç»„ä»¶åº“
        packages_file_path = 'VulLibGen/white_list/label_desc.json'
    elif language == 'c':
        pros_path = 'VulLibGen/white_list/label_desc_c.csv'        # Cç»„ä»¶åº“
        packages_file_path = 'VulLibGen/white_list/label_desc_c.json'
```

#### Step 4: è°ƒç”¨æ£€æµ‹ç®—æ³•

```python
result = tf_idf.tiny_model_process_data_to_json(
    trains=trains,
    tests=tests,
    pros_path=pros_path,
    detect_strategy=detect_strategy,
    language=language,
    similarityThreshold=similarityThreshold
)
```

#### Step 5: åå¤„ç†è¿‡æ»¤

```python
# åˆ›å»ºä¸´æ—¶JSONæ–‡ä»¶
with tempfile.NamedTemporaryFile(mode='w+', delete=False, suffix='.json') as json_temp_file:
    json.dump(white_list, json_temp_file, ensure_ascii=False, indent=4)
    json_temp_file_path = json_temp_file.name

# ä½¿ç”¨ç›¸ä¼¼åº¦ç®—æ³•è¿‡æ»¤
if detect_strategy == 'TinyModel-lev':
    result = process_libraries(similarityThreshold, "lev", result, json_temp_file_path)
if detect_strategy == 'TinyModel-cos':
    result = process_libraries(similarityThreshold, "cos", result, json_temp_file_path)
if detect_strategy == 'TinyModel-lcs':
    result = process_libraries(similarityThreshold, "lcs", result, json_temp_file_path)
```

---

## ä¸‰ã€æ£€æµ‹ç®—æ³•è¯¦è§£

### 3.1 TF-IDF æ£€æµ‹ç®—æ³•

**æ–‡ä»¶ä½ç½®**: `C:\Users\ä»»è‰¯ç‰\Desktop\kuling\kulin\VulLibGen\tf_idf\tf_idf.py`

#### tiny_model_process_data_to_json()

**è¾“å…¥**:
- trains: è®­ç»ƒæ•°æ®ï¼ˆé€šå¸¸ä¸ºç©ºæˆ–ä¸testsç›¸åŒï¼‰
- tests: æµ‹è¯•æ•°æ®ï¼ˆåŒ…å«CVEå’Œæè¿°ï¼‰
- pros_path: CSVæ–‡ä»¶è·¯å¾„ï¼ˆåŒ…å«ç»„ä»¶åº“ï¼‰
- language: ç¼–ç¨‹è¯­è¨€ ("java" æˆ– "c")
- similarityThreshold: ç›¸ä¼¼åº¦é˜ˆå€¼

**å¤„ç†æµç¨‹**:
```
1. åŠ è½½ pros_path CSV æ–‡ä»¶
   â””â”€> åŒ…å«æ‰€æœ‰å·²çŸ¥çš„ç»„ä»¶å’Œæè¿°

2. è®¡ç®— TF-IDF å‘é‡
   â””â”€> ä¸ºæ¼æ´æè¿°è®¡ç®—TF-IDF
   â””â”€> ä¸ºæ¯ä¸ªç»„ä»¶æè¿°è®¡ç®—TF-IDF

3. ç›¸ä¼¼åº¦è®¡ç®—
   â””â”€> ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦å¯¹æ¯”æ¼æ´æè¿°ä¸ç»„ä»¶æè¿°
   â””â”€> è¿”å›åŒ¹é…å¾—åˆ†

4. æ’åºå’Œç­›é€‰
   â””â”€> æŒ‰ç›¸ä¼¼åº¦ä»é«˜åˆ°ä½æ’åº
   â””â”€> è¿”å›æ‰€æœ‰ç»„ä»¶ï¼ˆåç»­åå¤„ç†ä¼šä½¿ç”¨é˜ˆå€¼è¿‡æ»¤ï¼‰

5. è¿”å›ç»“æœ
   â””â”€> æ ¼å¼: "component1;component2;component3;..."
```

#### llm_process_data_to_json()

**è¾“å…¥**: åŒä¸Šï¼Œä½†é¢å¤–åŒ…å«:
- pros_json_path: JSONæ–‡ä»¶è·¯å¾„

**å¤„ç†æµç¨‹**:
```
1. åŠ è½½ pros_csv å’Œ pros_json
   â””â”€> CSV: ç»„ä»¶IDå’Œåç§°æ˜ å°„
   â””â”€> JSON: ç»„ä»¶è¯¦ç»†ä¿¡æ¯

2. è°ƒç”¨ LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰è¿›è¡ŒåŒ¹é…
   â””â”€> ä½¿ç”¨è¯¸å¦‚ Qwenã€DeepSeek ç­‰æ¨¡å‹
   â””â”€> æ¨¡å‹åŸºäºè¯­ä¹‰ç†è§£æ¼æ´æè¿°

3. è·å– LLM çš„æ’åç»“æœ
   â””â”€> LLM è¿”å›åŒ¹é…çš„ç»„ä»¶åˆ—è¡¨ï¼ˆå¸¦ç›¸ä¼¼åº¦å¾—åˆ†ï¼‰

4. è¿”å›ç»“æœ
   â””â”€> æ ¼å¼: åŒ tiny_model
```

### 3.2 åå¤„ç†: process_libraries()

**æ–‡ä»¶ä½ç½®**: `C:\Users\ä»»è‰¯ç‰\Desktop\kuling\kulin\VulLibGen\tf_idf\threshold_cal.py`

**åŠŸèƒ½**: ä½¿ç”¨é¢å¤–çš„ç›¸ä¼¼åº¦ç®—æ³•è¿›ä¸€æ­¥è¿‡æ»¤ç»“æœ

**æ”¯æŒçš„ç®—æ³•**:
1. **Levenshtein** (`lev`)
   - è®¡ç®—ç¼–è¾‘è·ç¦»
   - ç”¨äºå­—ç¬¦ä¸²ç›¸ä¼¼åº¦

2. **Cosine Similarity** (`cos`)
   - ä½™å¼¦ç›¸ä¼¼åº¦
   - ç”¨äºå‘é‡ç©ºé—´

3. **Longest Common Subsequence** (`lcs`)
   - æœ€é•¿å…¬å…±å­åºåˆ—
   - ç”¨äºåºåˆ—ç›¸ä¼¼åº¦

**å¤„ç†æµç¨‹**:
```python
def process_libraries(threshold, similarity_type, result, json_file_path):
    # 1. è§£æåˆå§‹ç»“æœ
    matched_components = result.split(";")  # "comp1;comp2;comp3"

    # 2. åŠ è½½ç™½åå•JSON
    with open(json_file_path, 'r') as f:
        white_list = json.load(f)

    # 3. å¯¹æ¯ä¸ªåŒ¹é…çš„ç»„ä»¶åº”ç”¨ç›¸ä¼¼åº¦ç®—æ³•
    filtered_results = []
    for component in matched_components:
        for white_list_item in white_list:
            # è®¡ç®—ç›¸ä¼¼åº¦
            similarity_score = calculate_similarity(
                component,
                white_list_item['name'],
                similarity_type
            )

            # ä¸é˜ˆå€¼æ¯”è¾ƒ
            if similarity_score >= threshold:
                filtered_results.append(white_list_item['name'])

    # 4. è¿”å›è¿‡æ»¤åçš„ç»“æœ
    return ";".join(filtered_results)
```

---

## å››ã€è¿”å›æ ¼å¼

### 4.1 æˆåŠŸå“åº”

```json
"log4j-core;log4j-api;commons-logging"
```

### 4.2 å¤„ç†æµç¨‹

Flask è¿”å›çš„æ˜¯ä¸€ä¸ªä»¥åˆ†å·åˆ†éš”çš„ç»„ä»¶åç§°å­—ç¬¦ä¸²ã€‚

åœ¨åç«¯ï¼Œè¿™è¢«è§£æä¸ºï¼š
```java
List<String> componentList = Arrays.asList(matchedComponents.split(";"));
// ["log4j-core", "log4j-api", "commons-logging"]
```

ç„¶åä¸ç™½åå•è¿›è¡ŒåŒ¹é…ï¼Œä¸ºæ¯ä¸ªåŒ¹é…çš„ç»„ä»¶åˆ›å»ºæ¼æ´è®°å½•ã€‚

---

## äº”ã€æ£€æµ‹ç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | å…¨ç§° | ç‰¹ç‚¹ | æ€§èƒ½ | å‡†ç¡®åº¦ | ä½¿ç”¨åœºæ™¯ |
|------|------|------|------|--------|---------|
| TinyModel | TinyModel | æœ¬åœ°è½»é‡çº§æ¨¡å‹ | âš¡âš¡âš¡ å¿« | â­â­â­ ä¸­ç­‰ | å¯¹å®æ—¶æ€§è¦æ±‚é«˜ |
| TinyModel-lev | + Levenshteinè¿‡æ»¤ | åŠ å…¥ç¼–è¾‘è·ç¦» | âš¡âš¡ è¾ƒå¿« | â­â­â­â­ è¾ƒå¥½ | ç»„ä»¶åç›¸è¿‘çš„åŒ¹é… |
| TinyModel-cos | + Cosineè¿‡æ»¤ | åŠ å…¥å‘é‡ç›¸ä¼¼åº¦ | âš¡âš¡ è¾ƒå¿« | â­â­â­â­â­ å¾ˆå¥½ | æ¨èä½¿ç”¨ |
| TinyModel-lcs | + LCSè¿‡æ»¤ | åŠ å…¥åºåˆ—ç›¸ä¼¼åº¦ | âš¡ æ…¢ | â­â­â­â­â­ å¾ˆå¥½ | ç²¾ç¡®åº¦è¦æ±‚é«˜ |
| LLM | å¤§è¯­è¨€æ¨¡å‹ | ä½¿ç”¨æ·±åº¦å­¦ä¹  | ğŸ¢ å¾ˆæ…¢ | â­â­â­â­â­â­ æœ€å¥½ | å¤æ‚æ¼æ´æè¿° |
| LLM-lev | + Levenshteinè¿‡æ»¤ | äºŒæ¬¡è¿‡æ»¤ | ğŸ¢ å¾ˆæ…¢ | â­â­â­â­â­â­ æœ€å¥½ | å¯¹å‡†ç¡®åº¦è¦æ±‚æœ€é«˜ |

---

## å…­ã€å®é™…è¯·æ±‚ç¤ºä¾‹

### 6.1 åç«¯è°ƒç”¨ Flask çš„å®Œæ•´ç¤ºä¾‹

```java
// åç«¯ Spring Boot

// 1. å‡†å¤‡è¯·æ±‚å‚æ•°
Map<String, String> params = new HashMap<>();
params.put("cve_id", "CVE-2021-44228");
params.put("desc", "Apache Log4j2 allows attackers to execute arbitrary code via JNDI injection");
params.put("white_list", "[{\"name\": \"log4j-core\", \"language\": \"java\", \"pojectid\": \"1\"}, {\"name\": \"spring-web\", \"language\": \"java\", \"pojectid\": \"1\"}]");
params.put("company", "Alibaba");
params.put("detect_strategy", "TinyModel-cos");
params.put("similarityThreshold", "0.8");
params.put("language", "java");

// 2. å‘é€ HTTP è¯·æ±‚
HttpHeaders headers = new HttpHeaders();
headers.setContentType(MediaType.APPLICATION_JSON);
HttpEntity<Map<String, String>> requestEntity = new HttpEntity<>(params, headers);

ResponseEntity<String> response = restTemplate.exchange(
    "http://localhost:5000/vulnerabilities/detect",
    HttpMethod.POST,
    requestEntity,
    String.class
);

// 3. å¤„ç†å“åº”
String result = response.getBody();
System.out.println("Flask returned: " + result);
// Output: "log4j-core"

// 4. ä¿å­˜ç»“æœåˆ°æ•°æ®åº“
List<String> matchedComponents = Arrays.asList(result.split(";"));
for (String component : matchedComponents) {
    // åˆ›å»º Vulnerability è®°å½•
    Vulnerability vuln = new Vulnerability();
    vuln.setName("Log4j RCE");
    vuln.setDescription("Apache Log4j2 RCE vulnerability");
    vuln.setRef("CVE-2021-44228");
    vuln.setLanguage("java");
    vulnerabilityMapper.insert(vuln);

    // åˆ›å»ºå…³è”
    // ...
}
```

### 6.2 Flask å¤„ç†ç¤ºä¾‹

```python
# Flask app.py

@app.route('/vulnerabilities/detect', methods=['POST'])
def detect_vulnerabilities():
    params = request.get_json()

    # è°ƒç”¨ getLabels
    result = getLabels(params=params)

    # getLabels å†…éƒ¨å¤„ç†:
    # 1. è§£æå‚æ•°
    # 2. åŠ è½½ label_desc.csv (åŒ…å«æ‰€æœ‰Javaç»„ä»¶)
    # 3. è®¡ç®—æ¼æ´æè¿°ä¸ç»„ä»¶æè¿°çš„ç›¸ä¼¼åº¦
    # 4. è¿‡æ»¤ç›¸ä¼¼åº¦ >= 0.8 çš„ç»„ä»¶
    # 5. è¿”å› "log4j-core" (å¯èƒ½è¿˜æœ‰å…¶ä»–)

    return jsonify(result)
    # Returns: "log4j-core"
```

---

## ä¸ƒã€å…³äº autodl æ¥å£

æ ¹æ®æ—¥å¿—å’Œä»£ç åˆ†æï¼Œ**autodl ä¸æ˜¯åœ¨å½“å‰ä»£ç ä¸­ç›´æ¥è°ƒç”¨çš„**ã€‚

### autodl çš„è§’è‰²

autodl (AutoDL å®¹å™¨æœåŠ¡) å¯èƒ½ç”¨äºï¼š

1. **éƒ¨ç½² Flask æœåŠ¡**
   - åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒFlask åº”ç”¨å¯èƒ½è¿è¡Œåœ¨ autodl æä¾›çš„å®¹å™¨ä¸­
   - URL: `https://u2375886-aaed-c305b5ad.nmb2.seetacloud.com:8443/vulnerabilities/detect`

2. **LLM æ¨¡å‹æ¨ç†**
   - å¦‚æœä½¿ç”¨ LLM æ£€æµ‹ç­–ç•¥ï¼Œå¯èƒ½è°ƒç”¨ autodl ä¸Šçš„æ¨¡å‹æœåŠ¡
   - åœ¨ `VulLibGen/tf_idf/myinvocation.py` ä¸­å¯èƒ½æœ‰ç›¸å…³å®ç°

### å½“å‰éƒ¨ç½²

**æœ¬åœ°å¼€å‘ç¯å¢ƒ**:
- Flask è¿è¡Œåœ¨ `http://localhost:5000`
- ä½¿ç”¨æœ¬åœ°çš„ TinyModel å’Œ CSV/JSON ç»„ä»¶åº“
- ä¸ä¾èµ–å¤–éƒ¨ autodl æœåŠ¡

**ç”Ÿäº§ç¯å¢ƒ**:
- Flask å¯èƒ½è¿è¡Œåœ¨ autodl çš„å®¹å™¨ä¸­
- URL å˜ä¸º `https://u2375886-...../vulnerabilities/detect`
- åç«¯é…ç½®ä¼šç›¸åº”æ›´æ–°

---

## å…«ã€æ•°æ®æµæ€»ç»“è¡¨

| æ­¥éª¤ | ç»„ä»¶ | è¾“å…¥ | å¤„ç† | è¾“å‡º |
|------|------|------|------|------|
| 1 | Spring Boot | å…¬å¸ID + è¯­è¨€ | è·å–æ¼æ´æŠ¥å‘Šå’Œç™½åå• | CVE + ç™½åå•JSON |
| 2 | HTTP Client | - | æ„å»ºè¯·æ±‚å‚æ•° | JSONè¯·æ±‚ä½“ |
| 3 | Flask | JSONè¯·æ±‚ä½“ | /vulnerabilities/detect | å­—ç¬¦ä¸²å‚æ•° |
| 4 | getLabels.py | å‚æ•° | é€‰æ‹©ç­–ç•¥å’Œè¯­è¨€ | å¤„ç†å‚æ•° |
| 5 | tf_idf.py | CSV + æ¼æ´æè¿° | TF-IDF æˆ– LLM åŒ¹é… | æ’åºç»„ä»¶åˆ—è¡¨ |
| 6 | threshold_cal.py | ç»„ä»¶åˆ—è¡¨ | ç›¸ä¼¼åº¦è¿‡æ»¤ | è¿‡æ»¤åçš„ç»„ä»¶ |
| 7 | Flask è¿”å› | - | è¿”å›åˆ†å·åˆ†éš”çš„å­—ç¬¦ä¸² | "comp1;comp2;comp3" |
| 8 | Spring Boot | åŒ¹é…ç»„ä»¶ | ä¿å­˜ç»“æœ | æ•°æ®åº“è®°å½• |

---

## ä¹ã€å¸¸è§é—®é¢˜

### Q1: Flask å¦‚ä½•è°ƒç”¨ autodlï¼Ÿ
**A**: åœ¨å½“å‰ä»£ç ä¸­ï¼Œæ²¡æœ‰çœ‹åˆ°ç›´æ¥è°ƒç”¨ autodl çš„ä»£ç ã€‚autodl å¯èƒ½æ˜¯ï¼š
- éƒ¨ç½² Flask åº”ç”¨çš„å®¹å™¨å¹³å°
- åœ¨ LLM ç­–ç•¥ä¸­è°ƒç”¨è¿œç¨‹æ¨¡å‹æœåŠ¡ï¼ˆåœ¨ `myinvocation.py` ä¸­ï¼‰

### Q2: TinyModel å’Œ LLM çš„åŒºåˆ«ï¼Ÿ
**A**:
- **TinyModel**: ä½¿ç”¨ TF-IDF å‘é‡ç©ºé—´æ¨¡å‹ï¼ŒåŸºäºç»„ä»¶åå’Œæè¿°çš„è¯é¢‘ç»Ÿè®¡
- **LLM**: ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆå¦‚ Qwenã€DeepSeekï¼‰ï¼ŒåŸºäºè¯­ä¹‰ç†è§£

### Q3: ç›¸ä¼¼åº¦é˜ˆå€¼å¦‚ä½•è°ƒæ•´ï¼Ÿ
**A**:
```
- é˜ˆå€¼ = 0.5: å®½æ¾åŒ¹é…ï¼Œè¯¯æŠ¥å¤š
- é˜ˆå€¼ = 0.8: ä¸­ç­‰åŒ¹é…ï¼Œæ¨è
- é˜ˆå€¼ = 0.95: ä¸¥æ ¼åŒ¹é…ï¼Œæ¼æŠ¥å¤š
```

### Q4: å¦‚æœ Flask è¿”å›ç©ºå­—ç¬¦ä¸²æ€ä¹ˆåŠï¼Ÿ
**A**:
åœ¨ Spring Boot ä¸­ä¼šè¢«å¤„ç†ä¸ºï¼š
```java
if (labels == null || labels.trim().isEmpty()) {
    System.out.println("APIè¿”å›ç©ºç»“æœ");
    return null;  // ä¸ä¿å­˜ä»»ä½•æ¼æ´
}
```

---

## åã€éƒ¨ç½²å’Œé…ç½®

### æœ¬åœ°å¼€å‘é…ç½®

```properties
# application.properties
server.port=8081
flask.api.url=http://localhost:5000/vulnerabilities/detect
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```properties
server.port=8081
flask.api.url=https://u2375886-aaed-c305b5ad.nmb2.seetacloud.com:8443/vulnerabilities/detect
# éœ€è¦ SSL è¯ä¹¦é…ç½®
ssl.verify=false  # å¼€å‘ç¯å¢ƒå¯è®¾ç½®ä¸ºfalseï¼Œç”Ÿäº§ç¯å¢ƒåº”ä¸ºtrue
```

---

## åä¸€ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¹¶å‘å¤„ç†**: ä½¿ç”¨å¼‚æ­¥çº¿ç¨‹æ± å¤„ç†å¤šä¸ªæ¼æ´æ£€æµ‹è¯·æ±‚
2. **ç¼“å­˜ç»“æœ**: ç¼“å­˜ç›¸åŒCVEçš„æ£€æµ‹ç»“æœ
3. **é¢„åŠ è½½ç»„ä»¶åº“**: åœ¨å¯åŠ¨æ—¶åŠ è½½CSV/JSONï¼Œé¿å…é‡å¤IO
4. **é€‰æ‹©åˆé€‚ç­–ç•¥**:
   - å®æ—¶æ€§è¦æ±‚é«˜ â†’ TinyModel
   - å‡†ç¡®åº¦è¦æ±‚é«˜ â†’ TinyModel-cos / LLM
5. **å‡å°‘ç½‘ç»œè¯·æ±‚**: ä½¿ç”¨è¿æ¥æ± ï¼Œå¤ç”¨HTTPè¿æ¥

---

## åäºŒã€æ€»ç»“

æ•´ä¸ªæ¼æ´æ£€æµ‹ç³»ç»Ÿçš„æµç¨‹æ˜¯ï¼š

```
åç«¯è·å–æ¼æ´ + ç™½åå•
    â†“
è°ƒç”¨ Flask API
    â†“
Flask ä½¿ç”¨ TF-IDF æˆ– LLM åŒ¹é…ç»„ä»¶
    â†“
ä½¿ç”¨ç›¸ä¼¼åº¦ç®—æ³•è¿‡æ»¤
    â†“
è¿”å›åŒ¹é…çš„ç»„ä»¶åˆ—è¡¨
    â†“
åç«¯ä¿å­˜åˆ°æ•°æ®åº“
```

âœ… **ç³»ç»Ÿå¯ä»¥æˆåŠŸæ£€æµ‹æ¼æ´å¹¶å­˜å‚¨åˆ°æ•°æ®åº“ï¼**

---

**æ–‡æ¡£ä½œè€…**: Claude Code
**è”ç³»æ–¹å¼**: [Claude Code å®˜æ–¹æ–‡æ¡£](https://docs.claude.com)
