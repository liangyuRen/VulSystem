# 漏洞管理系统后端API接口文档

## 项目概述
本文档描述了漏洞管理系统后端的所有API接口，包括用户认证、公司管理、项目管理、漏洞管理和漏洞报告等功能模块。

## 通用响应格式
所有接口均使用统一的响应格式：

```json
{
  "code": 200,
  "message": "success",
  "data": {...}
}
```

- `code`: 状态码，200表示成功，其他值表示错误
- `message`: 响应消息
- `data`: 响应数据

## 1. 用户管理模块 (/user)

### 1.1 用户登录
- **接口地址**: `GET /user/login`
- **接口描述**: 用户登录验证
- **请求参数**:
  - `companyName` (String): 公司名称
  - `password` (String): 密码
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "userInfo": {...}
  }
}
```

## 2. 公司管理模块 (/company)

### 2.1 更新检测策略
- **接口地址**: `POST /company/updateStrategy`
- **接口描述**: 更新公司的漏洞检测策略配置
- **请求参数**:
  - `companyId` (Integer): 公司ID
  - `similarityThreshold` (double): 相似度阈值
  - `maxDetectNums` (Integer): 最大检测数量
  - `detect_strategy` (String): 检测策略
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": "更新成功"
}
```

### 2.2 获取检测策略
- **接口地址**: `GET /company/getStrategy`
- **接口描述**: 获取公司的漏洞检测策略配置
- **请求参数**:
  - `companyId` (Integer): 公司ID
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "similarityThreshold": 0.8,
    "maxDetectNums": 100,
    "detectStrategy": "comprehensive"
  }
}
```

## 3. 项目管理模块 (/project)

### 3.1 创建项目
- **接口地址**: `POST /project/create`
- **接口描述**: 创建新的项目
- **请求参数**:
  - `name` (String): 项目名称
  - `description` (String): 项目描述
  - `language` (String): 编程语言
  - `risk_threshold` (int): 风险阈值
  - `companyId` (int): 公司ID
  - `filePath` (String): 文件路径
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 3.2 上传文件
- **接口地址**: `POST /project/uploadFile`
- **接口描述**: 上传项目文件
- **请求参数**:
  - `file` (MultipartFile): 上传的文件
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "filePath": "/uploads/project_files/file_123.zip",
    "fileName": "project.zip",
    "fileSize": 1024000
  }
}
```

### 3.3 删除项目
- **接口地址**: `POST /project/delete`
- **接口描述**: 删除指定项目
- **请求参数**:
  - `id` (int): 项目ID
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 3.4 更新项目
- **接口地址**: `POST /project/update`
- **接口描述**: 更新项目信息
- **请求参数**:
  - `id` (int): 项目ID
  - `name` (String): 项目名称
  - `description` (String): 项目描述
  - `risk_threshold` (int): 风险阈值
  - `filePath` (String, 可选): 文件路径
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

### 3.5 获取项目漏洞信息
- **接口地址**: `GET /project/getVulnerabilities`
- **接口描述**: 获取项目的漏洞信息
- **请求参数**:
  - `id` (int): 项目ID
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "vulnerabilityName": "SQL注入",
      "riskLevel": "HIGH",
      "description": "存在SQL注入风险",
      "location": "UserController.java:25"
    }
  ]
}
```

### 3.6 获取项目列表
- **接口地址**: `GET /project/list`
- **接口描述**: 分页获取公司的项目列表
- **请求参数**:
  - `companyId` (int): 公司ID
  - `page` (int): 页码
  - `size` (int): 每页数量
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 50,
    "pages": 5,
    "current": 1,
    "size": 10,
    "records": [
      {
        "id": 1,
        "name": "项目A",
        "description": "项目描述",
        "language": "Java",
        "createTime": "2024-01-01 10:00:00"
      }
    ]
  }
}
```

### 3.7 获取项目统计信息
- **接口地址**: `GET /project/statistics`
- **接口描述**: 获取公司项目的统计信息
- **请求参数**:
  - `companyId` (int): 公司ID
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalProjects": 25,
    "highRiskProjects": 5,
    "mediumRiskProjects": 10,
    "lowRiskProjects": 10,
    "totalVulnerabilities": 150
  }
}
```

### 3.8 获取项目详细信息
- **接口地址**: `GET /project/info`
- **接口描述**: 获取项目的详细信息
- **请求参数**:
  - `projectid` (int): 项目ID
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "项目A",
    "description": "项目描述",
    "language": "Java",
    "riskThreshold": 3,
    "companyId": 1,
    "filePath": "/uploads/project_a.zip",
    "createTime": "2024-01-01 10:00:00",
    "updateTime": "2024-01-02 15:30:00"
  }
}
```

### 3.9 导出SBOM文件
- **接口地址**: `GET /project/sbom`
- **接口描述**: 导出项目的SBOM（软件物料清单）文件
- **请求参数**:
  - `projectId` (int): 项目ID
  - `format` (String): 导出格式（如：json、xml）
  - `outFileName` (String): 输出文件名
- **响应**: 直接返回文件下载流
- **响应头**:
  - `Content-Disposition`: attachment; filename="sbom_file.json"
  - `Content-Type`: application/octet-stream

## 4. 漏洞管理模块 (/vulnerability)

### 4.1 采纳/拒绝漏洞建议
- **接口地址**: `POST /vulnerability/accept`
- **接口描述**: 对漏洞检测建议进行采纳或拒绝操作
- **请求参数**:
  - `vulnerabilityid` (int): 漏洞ID
  - `ifaccept` (int): 是否采纳（1=采纳，0=拒绝）
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

## 5. 漏洞报告模块 (/vulnerabilityReport)

### 5.1 获取漏洞报告列表
- **接口地址**: `GET /vulnerabilityReport/list`
- **接口描述**: 分页获取漏洞报告列表
- **请求参数**:
  - `page` (int, 默认值: 1): 页码
  - `size` (int, 默认值: 10): 每页数量
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 100,
    "pages": 10,
    "current": 1,
    "size": 10,
    "records": [
      {
        "id": 1,
        "title": "高危漏洞报告",
        "riskLevel": "HIGH",
        "description": "发现SQL注入漏洞",
        "createTime": "2024-01-01 10:00:00",
        "projectName": "项目A"
      }
    ]
  }
}
```

### 5.2 搜索漏洞报告
- **接口地址**: `GET /vulnerabilityReport/search`
- **接口描述**: 根据关键词搜索漏洞报告
- **请求参数**:
  - `keyword` (String): 搜索关键词
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "title": "SQL注入漏洞报告",
      "riskLevel": "HIGH",
      "description": "在用户登录模块发现SQL注入漏洞",
      "createTime": "2024-01-01 10:00:00"
    }
  ]
}
```

### 5.3 过滤漏洞报告
- **接口地址**: `GET /vulnerabilityReport/filter`
- **接口描述**: 根据风险等级和时间范围过滤漏洞报告
- **请求参数**:
  - `riskLevel` (String, 可选): 风险等级（HIGH/MEDIUM/LOW）
  - `startDate` (String, 可选): 开始日期（格式：yyyy-MM-dd）
  - `endDate` (String, 可选): 结束日期（格式：yyyy-MM-dd）
- **响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "title": "高危漏洞报告",
      "riskLevel": "HIGH",
      "description": "发现严重安全漏洞",
      "createTime": "2024-01-01 10:00:00",
      "projectName": "项目A"
    }
  ]
}
```

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权访问 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 注意事项

1. 所有POST请求的Content-Type应为`application/x-www-form-urlencoded`或`multipart/form-data`（文件上传）
2. 除登录接口外，其他接口可能需要在请求头中携带认证token
3. 分页参数中，page从1开始计数
4. 文件上传接口支持的文件格式请咨询具体业务需求
5. 时间格式统一使用`yyyy-MM-dd HH:mm:ss`
6. 风险等级枚举值：HIGH（高危）、MEDIUM（中危）、LOW（低危）

## 版本信息
- 文档版本：v1.0
- 最后更新：2024-09-30
- API版本：v1.0